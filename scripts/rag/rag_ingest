#!/bin/bash
# scripts/rag_ingest

# Get directory of this script
# Get directory of this script
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
INGEST_SCRIPT="$SCRIPT_DIR/ingest.py"
# Environment Discovery
GLOBAL_VENV="$HOME/Library/Application Support/Code - Insiders/rag_env"
LOCAL_VENV="$(dirname "$(dirname "$SCRIPT_DIR")")/.venv"

if [ -d "$GLOBAL_VENV" ]; then
    VENV_DIR="$GLOBAL_VENV"
elif [ -d "$LOCAL_VENV" ]; then
    VENV_DIR="$LOCAL_VENV"
else
    echo "RAG environment not found (checked $GLOBAL_VENV and $LOCAL_VENV)"
    echo "Please run scripts/rag/setup-rag.sh first."
    exit 1
fi

# Activate venv and run ingest
source "$VENV_DIR/bin/activate"
python3 "$INGEST_SCRIPT" "$@"
